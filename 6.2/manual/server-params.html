<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title> Service parameters </title><meta charset="utf8"/></head><body><h1> Eliom's Reference manual</h1><h2><a href="/eliom/6.2/manual/intro.html" class="ocsimore_phrasing_link">Introduction</a></h2><h2>Server-side programming</h2><h3>Services</h3><h4><a href="/eliom/6.2/manual/server-services.html" class="ocsimore_phrasing_link">The different types of services</a></h4><h4><a href="/eliom/6.2/manual/server-params.html" class="ocsimore_phrasing_link">Typing service parameters</a></h4><h4><a href="/eliom/6.2/manual/server-outputs.html" class="ocsimore_phrasing_link">Service handlers</a></h4><h4><a href="/eliom/6.2/manual/server-links.html" class="ocsimore_phrasing_link">Creating links and forms</a></h4><h3><a href="/eliom/6.2/manual/server-state.html" class="ocsimore_phrasing_link">Sessions and server side state</a></h3><h3><a href="/eliom/6.2/manual/server-security.html" class="ocsimore_phrasing_link">Security</a></h3><h2>Client-server programming</h2><h3><a href="/eliom/6.2/manual/clientserver-applications.html" class="ocsimore_phrasing_link">Eliom applications</a></h3><h3><a href="/eliom/6.2/manual/clientserver-html.html" class="ocsimore_phrasing_link">Generating HTML</a></h3><h3><a href="/eliom/6.2/manual/clientserver-communication.html" class="ocsimore_phrasing_link">Communication</a></h3><h3><a href="/eliom/6.2/manual/clientserver-services.html" class="ocsimore_phrasing_link">Client-side services</a></h3><h3><a href="/eliom/6.2/manual/clientserver-react.html" class="ocsimore_phrasing_link">Shared reactive programming</a></h3><h3><a href="/eliom/6.2/manual/clientserver-cache.html" class="ocsimore_phrasing_link">Caching data and off-line applications</a></h3><h3><a href="/eliom/6.2/manual/clientserver-wrapping.html" class="ocsimore_phrasing_link">Custom wrapping</a></h3><h2>Workflows</h2><h3><a href="/eliom/6.2/manual/workflow-distillery.html" class="ocsimore_phrasing_link">Distillery</a></h3><h3><a href="/eliom/6.2/manual/mobile-apps.html" class="ocsimore_phrasing_link">Mobile apps</a></h3><h3><a href="/eliom/6.2/manual/workflow-compilation.html" class="ocsimore_phrasing_link">Compilation</a></h3><h3><a href="/eliom/6.2/manual/workflow-configuration.html" class="ocsimore_phrasing_link">Configuration &amp; running</a></h3><h3><a href="/eliom/6.2/manual/scalability.html" class="ocsimore_phrasing_link">Scalability</a></h3><h2>Syntax</h2><h3><a href="/eliom/6.2/manual/ppx-syntax.html" class="ocsimore_phrasing_link">PPX-based syntax</a></h3><h3><a href="/eliom/6.2/manual/clientserver-language.html" class="ocsimore_phrasing_link">Camlp4-based syntax</a></h3><h3><a href="/eliom/6.2/manual/ppx-migration.html" class="ocsimore_phrasing_link">Migration to PPX</a></h3><h1>Client API</h1><h2><a href="/eliom/6.2/api/client/Eliom_lib.html" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href="/eliom/6.2/api/client/Eliom_client.html" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href="/eliom/6.2/api/client/Eliom_client_value.html" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2>Content and form creation</h2><h3><a href="/eliom/6.2/api/client/Eliom_content.Html.html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_content.Svg.html" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_content.Xml.html" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h2>Client/server communication</h2><h3><a href="/eliom/6.2/api/client/Eliom_service.html" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_shared.html" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_cscache.html" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_bus.html" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_comet.html" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_react.html" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_types.html">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_exceptions.html">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_values.html">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_modules.html">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_module_types.html">Index of module types</a></span></h3><h1>Ocamlbuild plugin</h1><h2><a href="/eliom/6.2/api/ocamlbuild/Ocamlbuild_eliom.html" class="ocsimore_phrasing_link">Ocamlbuild_eliom</a></h2><h1>Ppx syntax</h1><h2><a href="/eliom/6.2/api/ppx/Ppx_eliom.html" class="ocsimore_phrasing_link">Ppx_eliom</a></h2><h1>Server API</h1><h2><a href="/eliom/6.2/api/server/Eliom_lib.html" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_client.html" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_client_value.html" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_common.html" class="ocsimore_phrasing_link">Eliom_common</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_config.html" class="ocsimore_phrasing_link">Eliom_config</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_request_info.html" class="ocsimore_phrasing_link">Eliom_request_info</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_reference.html" class="ocsimore_phrasing_link">Eliom_reference</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_state.html" class="ocsimore_phrasing_link">Eliom_state</a></h2><h2>Content and form creation</h2><h3><a href="/eliom/6.2/api/server/Eliom_content.html" class="ocsimore_phrasing_link">Eliom_content</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Html.html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Svg.html" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Xml.html" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_tools.html" class="ocsimore_phrasing_link">Eliom_tools</a></h3><h2>Service creation</h2><h3><a href="/eliom/6.2/api/server/Eliom_service.html" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_parameter.html" class="ocsimore_phrasing_link">Eliom_parameter</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.html" class="ocsimore_phrasing_link">Eliom_registration</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Html.html" class="ocsimore_phrasing_link">Eliom_registration.Html</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Action.html" class="ocsimore_phrasing_link">Eliom_registration.Action</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Ocaml.html" class="ocsimore_phrasing_link">Eliom_registration.Ocaml</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.App.html" class="ocsimore_phrasing_link">Eliom_registration.App</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.File.html" class="ocsimore_phrasing_link">Eliom_registration.File</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Any.html" class="ocsimore_phrasing_link">Eliom_registration.Any</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Redirection.html" class="ocsimore_phrasing_link">Eliom_registration.Redirection</a></h3><h2>Client/server communication</h2><h3><a href="/eliom/6.2/api/server/Eliom_shared.html" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_notif.html" class="ocsimore_phrasing_link">Eliom_notif</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_cscache.html" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_bus.html" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_comet.html" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_react.html" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_types.html">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_exceptions.html">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_values.html">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_modules.html">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_module_types.html">Index of module types</a></span></h3><h1> Service parameters </h1><p>&lt;&lt;outline depth=&quot;2&quot;| &lt;&lt;header| **Table of contents** &gt;&gt; &gt;&gt;
</p><h2 id="parameters"> Parameters  <a class="backref" href="#parameters">&#182;</a></h2><h3> Services with parameters </h3><p>Service handlers take two parameters. The first one is for GET
parameters (that is, parameters in the URL) and the second one for
POST parameters (parameters in the body of the HTTP request).
</p><p>The parameters of a service are provided via the arguments of the
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_service_sigs.TYPES.html#TYPEmeth">Eliom_service_sigs.​TYPES.​meth</a></span>
constructors. The specification of parameter types is done using
combinators defined in the module
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_parameter.html">Eliom_parameter</a></span>.
For example, <span class="teletype">Eliom_parameter.unit</span> means that the service does
not take any parameter, and <span class="teletype">Eliom_parameter.int &quot;foo&quot;</span> means that
the service takes a parameter called <span class="teletype">foo</span>, which is of type
<span class="teletype">int</span>. See
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_parameter_sigs.S.html">Eliom_parameter_sigs.​S</a></span>
for documentation on the combinators.
</p><p>Here is an example of a service with GET parameters:
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let writeparams (i1, (i2, s1)) () = Lwt.return @@
  let open Eliom_content.Html.D in
  html
    (head (title (pcdata &quot;&quot;)) [])
    (body
       [p [pcdata &quot;You sent: &quot;;
           strong [pcdata (string_of_int i1)];
           pcdata &quot;, &quot;;
           strong [pcdata (string_of_int i2)];
           pcdata &quot; and &quot;;
           strong [pcdata s1]]])
&gt;&gt;
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let service_with_params =
  Eliom_registration.Html.create
    ~path:(Eliom_service.Path [&quot;thepath&quot;])
    ~meth:
      (Eliom_service.Get
         Eliom_parameter.(int &quot;i&quot; ** (int &quot;ii&quot; ** string &quot;s&quot;)))
    writeparams
&gt;&gt;
</p><p>Eliom will automaticaly try to convert the parameters and call the
handler with the right OCaml types (here <span class="teletype">int * (int * string)</span>).
</p><p>It is possible to register several services on the same path,
if they do not have the same parameters. Eliom will try them
in order of registration until one of them is able to answer.
We send an error otherwise.
</p><p>In the example above, if <span class="teletype">i</span> is not an integer,
the server will display an error message
(try to change the value in the URL).<br/>
</p><p><em>Warning:</em> The infix function <span class="teletype">( ** )</span> can only be used to
construct pairs (not tuples).<br/>
</p><h3 id="suffix">Path suffixes as parameters <a class="backref" href="#suffix">&#182;</a></h3><p>The following example shows how to create a service with a &quot;suffix&quot;
parameter (taking the end of the URL as a parameter, as wikis very
often do), and how to get server information:
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let uasuffix =
  Eliom_registration.Html.create
    ~path:(Eliom_service.Path [&quot;uasuffix&quot;])
    ~meth:
      (Eliom_service.Get
         Eliom_parameter.(suffix (int &quot;year&quot; ** int &quot;month&quot;)))
    (fun (year, month) () -&gt; Lwt.return @@
      let open Eliom_content.Html.D in
      html
        (head (title (pcdata &quot;&quot;)) [])
        (body
           [p [pcdata &quot;The suffix of the url is &quot;;
               strong [pcdata (string_of_int year ^ &quot;/&quot; ^
                               string_of_int month)];
               pcdata &quot;, your user-agent is &quot;;
               strong [pcdata (Eliom_request_info.get_user_agent ())];
               pcdata &quot;, your IP is &quot;;
               strong [pcdata (Eliom_request_info.get_remote_ip ())]]]))
&gt;&gt;
</p><p>This service will answer to URLs like <span class="teletype">http://.../uasuffix/2000/11</span>.
</p><p>Suffix parameters have names, because we can create forms towards
these services. <span class="teletype">uasuffix/2000/11</span> is equivalent to
<span class="teletype">uasuffix/?year=2000&amp;month=11</span>.<br/>
<span class="teletype">suffix_prod</span> allows both a suffix and other parameters.<br/>
<span class="teletype">all_suffix</span> allows the end of the suffix to be taken as a
<span class="teletype">string list</span>.<br/>
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let isuffix =
  Eliom_registration.Html.create
    ~path:(Eliom_service.Path [&quot;isuffix&quot;])
    ~meth:
      (Eliom_service.Get
         Eliom_parameter.
           (suffix_prod (int &quot;suff&quot; ** all_suffix &quot;endsuff&quot;) (int &quot;i&quot;)))
    (fun ((suff, endsuff), i_param) () -&gt; Lwt.return @@
      let open Eliom_content.Html.D in
      html
        (head (title (pcdata &quot;&quot;)) [])
        (body
           [p [pcdata &quot;The suffix of the url is &quot;;
               strong [pcdata (string_of_int suff)];
               pcdata &quot; followed by &quot;;
               strong [pcdata
                         (Ocsigen_lib.Url.string_of_url_path
                            ~encode:false
                            endsuff)];
               pcdata &quot; and i is equal to &quot;;
               strong [pcdata (string_of_int i_param)]]]))
&gt;&gt;
</p><p>If you want parameters in the path but not always at the end,
use the <span class="teletype">const</span> parameter specification.
It will match for example URLs like <span class="teletype">/param1/const/param2</span>.
Example:
&lt;&lt;code language=&quot;ocaml&quot;|
let constfix =
  Eliom_registration.Html.create
    ~path:(Eliom_service.Path [&quot;constfix&quot;])
    ~meth:
      (Eliom_service.Get
         Eliom_parameter.
           (suffix (string &quot;s1&quot; ** (suffix_const &quot;toto&quot; ** string &quot;s2&quot;))))
    (fun (s1, ((), s2)) () -&gt; Lwt.return @@
      let open Eliom_content.Html.D in
      html
        (head (title (pcdata &quot;&quot;)) [])
        (body [
           h1 [pcdata &quot;Suffix with constants&quot;];
           p [pcdata (&quot;Parameters are &quot;^s1^&quot; and &quot;^s2)]]))
&gt;&gt;
</p><h3>Custom parameter types</h3><p>The following example shows how to use your own types :
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
type mysum = A | B

let mysum_of_string = function
  | &quot;A&quot; -&gt; A
  | &quot;B&quot; -&gt; B
  | _ -&gt; raise (Failure &quot;mysum_of_string&quot;)

let string_of_mysum = function
  | A -&gt; &quot;A&quot;
  | B -&gt; &quot;B&quot;

let mytype =
  Eliom_registration.Html.create
    ~path:(Eliom_service.Path [&quot;mytype&quot;])
    ~meth:
      (Eliom_service.Get
         (Eliom_parameter.user_type
            mysum_of_string
            string_of_mysum
            &quot;value&quot;))
    (fun x () -&gt; Lwt.return @@
      let open Eliom_content.Html.D in
      html
        (head (title (pcdata &quot;&quot;)) [])
        (body [p [pcdata
                    (string_of_mysum x ^
                     &quot; is valid. Now try with another value.&quot;)]]))
&gt;&gt;
</p><p>See also <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/manual/clientserver-communication.html#client_sending_data">Client sending data</a></span> in the chapter
about client-server communication, which shows how to use a <span class="teletype">user_type</span>
from the client-side.
</p><h3 id="any">Untyped parameters <a class="backref" href="#any">&#182;</a></h3><p>If you want a service that answers to requests with any parameters,
use the <span class="teletype">any</span> combinator. The service will get an association list
of strings. For example:
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let raw_serv =
  Eliom_registration.Html.create
    ~path:(Eliom_service.Path [&quot;any&quot;])
    ~meth:(Eliom_service.Get Eliom_parameter.any)
  (fun l () -&gt;
    let module Html = Eliom_content.Html.D in
    let ll =
      List.map
        (fun (a,s) -&gt; &lt;&lt; &lt;strong&gt;($str:a$, $str:s$)&lt;/strong&gt; ~&gt;&gt;) l
    in
    Lwt.return
     &lt;&lt; &lt;html&gt;
          &lt;head&gt;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;
          &lt;body&gt;
          &lt;p&gt;
            You sent:
            $list:ll$
          &lt;/p&gt;
          &lt;/body&gt;
        &lt;/html&gt; ~&gt;&gt;)
&gt;&gt;

It is possible to use {{{Eliom_parameter.any}}} with other parameter
combinators, but {{{any}}} must be the last one. For example:
{{{(int &quot;i&quot; ** any)}}}.

==@@id=&quot;nonlocalizedparameters&quot;@@Non localized parameters==

Non-localized parameters are GET or POST parameters that are not taken
into account by Eliom for choosing the service.  They have a special
prefix (added automatically by Eliom).  Use this if you want some
information to be available or not, through parameters, for all of
your services.

&lt;&lt;code language=&quot;ocaml&quot;|
let my_nl_params =
  Eliom_parameter.make_non_localized_parameters
    ~prefix:&quot;tutoeliom&quot;
    ~name:&quot;mynlparams&quot;
    Eliom_parameter.(int &quot;a&quot; ** string &quot;s&quot;)

let nlparams =
  let open Eliom_content.Html.D in
  Eliom_registration.Html.create
    ~path:(Eliom_service.Path [&quot;nlparams&quot;])
    ~meth:(Eliom_service.Get (Eliom_parameter.int &quot;i&quot;))
    (fun i () -&gt; Lwt.return @@
      html
        (head (title (pcdata &quot;&quot;)) [])
        (body [
           p [pcdata &quot;i = &quot;; strong [pcdata (string_of_int i)]];
           match Eliom_parameter.get_non_localized_get_parameters
                   my_nl_params
           with
           | None -&gt;
             p [pcdata &quot;I do not have my non localized parameters&quot;]
           | Some (a, s) -&gt;
             p [pcdata &quot;I have my non localized parameters, &quot;;
                pcdata (Printf.sprintf &quot;with values a = %d and s = %s.&quot; a s)]
         ]))
&gt;&gt;


To create a link or a form with non-localized parameters, use the
optional parameter &lt;&lt;span class=&quot;code&quot;|nl_params&gt;&gt; of functions
{{{Eliom_content.Html.D.a}}}, {{{Eliom_content.Html.D.Form.get_form}}}, or
{{{Eliom_content.Html.D.Form.post_form}}}. Example:

&lt;&lt;code language=&quot;ocaml&quot;|
let tonlparams =
  Eliom_registration.Html.create
    ~path:(Eliom_service.Path [&quot;nlparams&quot;])
    ~meth:(Eliom_service.Get Eliom_parameter.unit)
    (fun i () -&gt; Lwt.return @@
      let open Eliom_content.Html.D in
      html
        (head (title (pcdata &quot;&quot;)) [])
        (body
           [p [a ~service:nlparams [pcdata &quot;without nl params&quot;] 4];
            p [a ~service:nlparams
                 ~nl_params:
                   (Eliom_parameter.add_nl_parameter
                      Eliom_parameter.empty_nl_params_set
                      my_nl_params
                      (22, &quot;oh&quot;))
                 [pcdata &quot;with nl params&quot;]
                 5];
            Form.get_form
              ~service:nlparams
              ~nl_params:
                (Eliom_parameter.add_nl_parameter
                   Eliom_parameter.empty_nl_params_set
                   my_nl_params
                   (22, &quot;oh&quot;))
              (fun iname -&gt;
                 [p [pcdata &quot;form with hidden nl params&quot;;
                     Form.input
                       ~input_type:`Text ~name:iname
                       Form.int;
                     Form.input
                       ~input_type:`Submit ~value:&quot;Send&quot;
                       Form.string]]);
            Form.get_form ~service:nlparams (fun iname -&gt;
              let (aname, sname) =
                Eliom_parameter.get_nl_params_names my_nl_params
              in
              [p [
                 pcdata &quot;form with nl params fields&quot;;
                 Form.input ~input_type:`Text ~name:iname Form.int;
                 Form.input ~input_type:`Text ~name:aname Form.int;
                 Form.input ~input_type:`Text ~name:sname Form.string;
                 Form.input ~input_type:`Submit ~value:&quot;Send&quot; Form.string]]);
           ]))
&gt;&gt;

It is also possible to create a new service by adding the
non-localized parameters to an existing service:

&lt;&lt;code language=&quot;ocaml&quot;|let nlparams_with_nlp =
  Eliom_service.add_non_localized_get_parameters my_nl_params nlparams
&gt;&gt;

Then create your link as usual.
 syntax error in wikisyntax&gt;&gt;</p></body></html>
