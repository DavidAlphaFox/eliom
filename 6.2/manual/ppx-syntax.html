<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Eliom PPX syntax extension</title><meta charset="utf8"/></head><body><h1> Eliom's Reference manual</h1><h2><a href="/eliom/6.2/manual/intro.html" class="ocsimore_phrasing_link">Introduction</a></h2><h2>Server-side programming</h2><h3>Services</h3><h4><a href="/eliom/6.2/manual/server-services.html" class="ocsimore_phrasing_link">The different types of services</a></h4><h4><a href="/eliom/6.2/manual/server-params.html" class="ocsimore_phrasing_link">Typing service parameters</a></h4><h4><a href="/eliom/6.2/manual/server-outputs.html" class="ocsimore_phrasing_link">Service handlers</a></h4><h4><a href="/eliom/6.2/manual/server-links.html" class="ocsimore_phrasing_link">Creating links and forms</a></h4><h3><a href="/eliom/6.2/manual/server-state.html" class="ocsimore_phrasing_link">Sessions and server side state</a></h3><h3><a href="/eliom/6.2/manual/server-security.html" class="ocsimore_phrasing_link">Security</a></h3><h2>Client-server programming</h2><h3><a href="/eliom/6.2/manual/clientserver-applications.html" class="ocsimore_phrasing_link">Eliom applications</a></h3><h3><a href="/eliom/6.2/manual/clientserver-html.html" class="ocsimore_phrasing_link">Generating HTML</a></h3><h3><a href="/eliom/6.2/manual/clientserver-communication.html" class="ocsimore_phrasing_link">Communication</a></h3><h3><a href="/eliom/6.2/manual/clientserver-services.html" class="ocsimore_phrasing_link">Client-side services</a></h3><h3><a href="/eliom/6.2/manual/clientserver-react.html" class="ocsimore_phrasing_link">Shared reactive programming</a></h3><h3><a href="/eliom/6.2/manual/clientserver-cache.html" class="ocsimore_phrasing_link">Caching data and off-line applications</a></h3><h3><a href="/eliom/6.2/manual/clientserver-wrapping.html" class="ocsimore_phrasing_link">Custom wrapping</a></h3><h2>Workflows</h2><h3><a href="/eliom/6.2/manual/workflow-distillery.html" class="ocsimore_phrasing_link">Distillery</a></h3><h3><a href="/eliom/6.2/manual/mobile-apps.html" class="ocsimore_phrasing_link">Mobile apps</a></h3><h3><a href="/eliom/6.2/manual/workflow-compilation.html" class="ocsimore_phrasing_link">Compilation</a></h3><h3><a href="/eliom/6.2/manual/workflow-configuration.html" class="ocsimore_phrasing_link">Configuration &amp; running</a></h3><h3><a href="/eliom/6.2/manual/scalability.html" class="ocsimore_phrasing_link">Scalability</a></h3><h2>Syntax</h2><h3><a href="/eliom/6.2/manual/ppx-syntax.html" class="ocsimore_phrasing_link">PPX-based syntax</a></h3><h3><a href="/eliom/6.2/manual/clientserver-language.html" class="ocsimore_phrasing_link">Camlp4-based syntax</a></h3><h3><a href="/eliom/6.2/manual/ppx-migration.html" class="ocsimore_phrasing_link">Migration to PPX</a></h3><h1>Client API</h1><h2><a href="/eliom/6.2/api/client/Eliom_lib.html" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href="/eliom/6.2/api/client/Eliom_client.html" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href="/eliom/6.2/api/client/Eliom_client_value.html" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2>Content and form creation</h2><h3><a href="/eliom/6.2/api/client/Eliom_content.Html.html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_content.Svg.html" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_content.Xml.html" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h2>Client/server communication</h2><h3><a href="/eliom/6.2/api/client/Eliom_service.html" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_shared.html" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_cscache.html" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_bus.html" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_comet.html" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_react.html" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_types.html">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_exceptions.html">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_values.html">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_modules.html">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_module_types.html">Index of module types</a></span></h3><h1>Ocamlbuild plugin</h1><h2><a href="/eliom/6.2/api/ocamlbuild/Ocamlbuild_eliom.html" class="ocsimore_phrasing_link">Ocamlbuild_eliom</a></h2><h1>Ppx syntax</h1><h2><a href="/eliom/6.2/api/ppx/Ppx_eliom.html" class="ocsimore_phrasing_link">Ppx_eliom</a></h2><h1>Server API</h1><h2><a href="/eliom/6.2/api/server/Eliom_lib.html" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_client.html" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_client_value.html" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_common.html" class="ocsimore_phrasing_link">Eliom_common</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_config.html" class="ocsimore_phrasing_link">Eliom_config</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_request_info.html" class="ocsimore_phrasing_link">Eliom_request_info</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_reference.html" class="ocsimore_phrasing_link">Eliom_reference</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_state.html" class="ocsimore_phrasing_link">Eliom_state</a></h2><h2>Content and form creation</h2><h3><a href="/eliom/6.2/api/server/Eliom_content.html" class="ocsimore_phrasing_link">Eliom_content</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Html.html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Svg.html" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Xml.html" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_tools.html" class="ocsimore_phrasing_link">Eliom_tools</a></h3><h2>Service creation</h2><h3><a href="/eliom/6.2/api/server/Eliom_service.html" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_parameter.html" class="ocsimore_phrasing_link">Eliom_parameter</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.html" class="ocsimore_phrasing_link">Eliom_registration</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Html.html" class="ocsimore_phrasing_link">Eliom_registration.Html</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Action.html" class="ocsimore_phrasing_link">Eliom_registration.Action</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Ocaml.html" class="ocsimore_phrasing_link">Eliom_registration.Ocaml</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.App.html" class="ocsimore_phrasing_link">Eliom_registration.App</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.File.html" class="ocsimore_phrasing_link">Eliom_registration.File</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Any.html" class="ocsimore_phrasing_link">Eliom_registration.Any</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Redirection.html" class="ocsimore_phrasing_link">Eliom_registration.Redirection</a></h3><h2>Client/server communication</h2><h3><a href="/eliom/6.2/api/server/Eliom_shared.html" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_notif.html" class="ocsimore_phrasing_link">Eliom_notif</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_cscache.html" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_bus.html" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_comet.html" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_react.html" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_types.html">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_exceptions.html">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_values.html">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_modules.html">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_module_types.html">Index of module types</a></span></h3><h1>Eliom PPX syntax extension</h1><p>The eliom syntax extension allows to write, in one file, both the
client and server part of your application. The extension is
automatically enabled by the <span class="teletype">eliomc</span> and <span class="teletype">js_of_eliom</span>
compilers on <span class="teletype">.eliom</span> and <span class="teletype">.eliomi</span> files.
</p><p>For the Camlp4 syntax extension, see
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/manual/clientserver-language.html">here </a></span>.
</p><p>The extensions presented here are also available with the <span class="teletype">eliom.</span>
prefix.
</p><h2>Sections</h2><p>The location of code execution is specified by section annotations. We
can specify that a declaration is performed on the server, or on the
client:
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
[%%server
  let s = ...
]

[%%client
  let c = ...
]
&gt;&gt;
</p><p>Some constructions have a shortcut:
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let%client c = ...
&gt;&gt;
</p><p>Finally, it's also possible to start a section for the rest of the file:
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
[%%server.start]
let s = ..
&gt;&gt;
</p><p>In <span class="teletype">.eliomi</span> files, only the last version is available.
</p><p>Sections are only available at top level and cannot be nested.
</p><h3>Shared sections</h3><p>Shared sections are also available for code that should be on the
client and on the server.
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let%shared sh = ...
&gt;&gt;
</p><p>This is equivalent to duplicating the code in a client and a server
section.
</p><h2>Fragments</h2><p>A client-side expression can be included inside a server section, and
the server can thereafter refer to it: an expression placed inside
<span class="teletype">[%client ... ]</span> will be computed on the client when it receives the
page; but the eventual client-side value of the expression can be
manipulated as a black box on the server.
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let%server x = [%client 1 + 3 ]
&gt;&gt;
</p><p>For example, here, the expression <span class="teletype">1 + 3</span> will be evaluated on the
client, but it’s possible to refer server-side to the future value of
this expression (for example, put it in a list). The value of a client
fragment cannot be accessed on the server.
</p><p>In this case, <span class="teletype">x</span> has type <span class="teletype">int fragment</span>.  Eliom can't always
infer the type of fragments. In this case, you may annotate the type:
<span class="teletype">[%client ( ... : &lt;type&gt; ) ]</span>.
</p><p>Client fragments cannot be nested.
</p><h3>Shared fragments</h3><p>It is also possible to use shared fragments.
&lt;&lt;code language=&quot;ocaml&quot;|
let%server x =  [%shared ...]
&gt;&gt;
</p><p>It will produce values of type
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_shared.Value.html#TYPEt">Eliom_shared.​Value.​t</a></span>.
</p><p>Shared fragments can be nested and can contain client fragments.
</p><h2>Injections and escaped values</h2><p>Values that have been computed on the server can be used on the client
by prefixing them with a percent symbol <span class="teletype">~%</span>. We call this an
<em>injection</em>.
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let%server s = 1 + 2
let%client c = ~%s + 1
&gt;&gt;
</p><p>Here, the expression <span class="teletype">1 + 2</span> is evaluated and bound to variable
<span class="teletype">s</span> on the server.  The resulting value <span class="teletype">3</span> is transferred to
the client together with the Web page, then the expression
<span class="teletype">~%s + 1</span> is computed client-side.  An injection makes it possible to
access client-side a client fragment which has been specified on the
server:
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
let%server x = [%client 1 + 3 ]
let%client c = 3 + ~%x
&gt;&gt;
</p><p>The value inside the client fragment is extracted by <span class="teletype">~%x</span>, whose
value is <span class="teletype">4</span> here.
</p><h2>Restrictions</h2><p>It is not possible to use injections on values containing a
closure. This includes lazy values, objects, or anything containing
functions. You can use either
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_client.html#TYPEserver_function">Eliom_client.​server_function</a></span>
and client or shared fragments to circumvent this limitation.
</p><p>To extend and customize the serialization from client to server, see
chapter <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/manual/clientserver-wrapping.html">Wrapping values</a></span>.
</p><h2>Note about evaluation</h2><p>Regardless of the construction used and their combination, there is
only one communication from server to client, when the Web page is
sent. This is due to the fact that client fragments are not executed
immediately when encountered inside server code.  The intuitive
semantic is the following: client code is not executed when
encountered, instead it is registered for later execution, once the
Web page has been sent to the client. Then all the client code is
executed in the order it was encountered on the server.
</p></body></html>
