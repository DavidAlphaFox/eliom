<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title> Programming client-server applications with Eliom</title><meta charset="utf8"/></head><body><h1> Eliom's Reference manual</h1><h2><a href="/eliom/6.2/manual/intro.html" class="ocsimore_phrasing_link">Introduction</a></h2><h2>Server-side programming</h2><h3>Services</h3><h4><a href="/eliom/6.2/manual/server-services.html" class="ocsimore_phrasing_link">The different types of services</a></h4><h4><a href="/eliom/6.2/manual/server-params.html" class="ocsimore_phrasing_link">Typing service parameters</a></h4><h4><a href="/eliom/6.2/manual/server-outputs.html" class="ocsimore_phrasing_link">Service handlers</a></h4><h4><a href="/eliom/6.2/manual/server-links.html" class="ocsimore_phrasing_link">Creating links and forms</a></h4><h3><a href="/eliom/6.2/manual/server-state.html" class="ocsimore_phrasing_link">Sessions and server side state</a></h3><h3><a href="/eliom/6.2/manual/server-security.html" class="ocsimore_phrasing_link">Security</a></h3><h2>Client-server programming</h2><h3><a href="/eliom/6.2/manual/clientserver-applications.html" class="ocsimore_phrasing_link">Eliom applications</a></h3><h3><a href="/eliom/6.2/manual/clientserver-html.html" class="ocsimore_phrasing_link">Generating HTML</a></h3><h3><a href="/eliom/6.2/manual/clientserver-communication.html" class="ocsimore_phrasing_link">Communication</a></h3><h3><a href="/eliom/6.2/manual/clientserver-services.html" class="ocsimore_phrasing_link">Client-side services</a></h3><h3><a href="/eliom/6.2/manual/clientserver-react.html" class="ocsimore_phrasing_link">Shared reactive programming</a></h3><h3><a href="/eliom/6.2/manual/clientserver-cache.html" class="ocsimore_phrasing_link">Caching data and off-line applications</a></h3><h3><a href="/eliom/6.2/manual/clientserver-wrapping.html" class="ocsimore_phrasing_link">Custom wrapping</a></h3><h2>Workflows</h2><h3><a href="/eliom/6.2/manual/workflow-distillery.html" class="ocsimore_phrasing_link">Distillery</a></h3><h3><a href="/eliom/6.2/manual/mobile-apps.html" class="ocsimore_phrasing_link">Mobile apps</a></h3><h3><a href="/eliom/6.2/manual/workflow-compilation.html" class="ocsimore_phrasing_link">Compilation</a></h3><h3><a href="/eliom/6.2/manual/workflow-configuration.html" class="ocsimore_phrasing_link">Configuration &amp; running</a></h3><h3><a href="/eliom/6.2/manual/scalability.html" class="ocsimore_phrasing_link">Scalability</a></h3><h2>Syntax</h2><h3><a href="/eliom/6.2/manual/ppx-syntax.html" class="ocsimore_phrasing_link">PPX-based syntax</a></h3><h3><a href="/eliom/6.2/manual/clientserver-language.html" class="ocsimore_phrasing_link">Camlp4-based syntax</a></h3><h3><a href="/eliom/6.2/manual/ppx-migration.html" class="ocsimore_phrasing_link">Migration to PPX</a></h3><h1>Server API</h1><h2><a href="/eliom/6.2/api/server/Eliom_lib.html" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_client.html" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_client_value.html" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_common.html" class="ocsimore_phrasing_link">Eliom_common</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_config.html" class="ocsimore_phrasing_link">Eliom_config</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_request_info.html" class="ocsimore_phrasing_link">Eliom_request_info</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_reference.html" class="ocsimore_phrasing_link">Eliom_reference</a></h2><h2><a href="/eliom/6.2/api/server/Eliom_state.html" class="ocsimore_phrasing_link">Eliom_state</a></h2><h2>Content and form creation</h2><h3><a href="/eliom/6.2/api/server/Eliom_content.html" class="ocsimore_phrasing_link">Eliom_content</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Html.html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Svg.html" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_content.Xml.html" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_tools.html" class="ocsimore_phrasing_link">Eliom_tools</a></h3><h2>Service creation</h2><h3><a href="/eliom/6.2/api/server/Eliom_service.html" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_parameter.html" class="ocsimore_phrasing_link">Eliom_parameter</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.html" class="ocsimore_phrasing_link">Eliom_registration</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Html.html" class="ocsimore_phrasing_link">Eliom_registration.Html</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Action.html" class="ocsimore_phrasing_link">Eliom_registration.Action</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Ocaml.html" class="ocsimore_phrasing_link">Eliom_registration.Ocaml</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.App.html" class="ocsimore_phrasing_link">Eliom_registration.App</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.File.html" class="ocsimore_phrasing_link">Eliom_registration.File</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Any.html" class="ocsimore_phrasing_link">Eliom_registration.Any</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_registration.Redirection.html" class="ocsimore_phrasing_link">Eliom_registration.Redirection</a></h3><h2>Client/server communication</h2><h3><a href="/eliom/6.2/api/server/Eliom_shared.html" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_notif.html" class="ocsimore_phrasing_link">Eliom_notif</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_cscache.html" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_bus.html" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_comet.html" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href="/eliom/6.2/api/server/Eliom_react.html" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_types.html">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_exceptions.html">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_values.html">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_modules.html">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/index_module_types.html">Index of module types</a></span></h3><h1>Client API</h1><h2><a href="/eliom/6.2/api/client/Eliom_lib.html" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href="/eliom/6.2/api/client/Eliom_client.html" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href="/eliom/6.2/api/client/Eliom_client_value.html" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2>Content and form creation</h2><h3><a href="/eliom/6.2/api/client/Eliom_content.Html.html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_content.Svg.html" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_content.Xml.html" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h2>Client/server communication</h2><h3><a href="/eliom/6.2/api/client/Eliom_service.html" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_shared.html" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_cscache.html" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_bus.html" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_comet.html" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href="/eliom/6.2/api/client/Eliom_react.html" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_types.html">Index of types</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_exceptions.html">Index of exceptions</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_values.html">Index of values</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_modules.html">Index of modules</a></span></h3><h3> <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/index_module_types.html">Index of module types</a></span></h3><h1>Ppx syntax</h1><h2><a href="/eliom/6.2/api/ppx/Ppx_eliom.html" class="ocsimore_phrasing_link">Ppx_eliom</a></h2><h1>Ocamlbuild plugin</h1><h2><a href="/eliom/6.2/api/ocamlbuild/Ocamlbuild_eliom.html" class="ocsimore_phrasing_link">Ocamlbuild_eliom</a></h2><h1> Programming client-server applications with Eliom</h1><p>&lt;&lt;outline depth=&quot;2&quot;| &lt;&lt;header| **Table of contents** &gt;&gt; &gt;&gt;
</p><h2> General principles</h2><h3> What is a client/server Eliom application</h3><p>An Eliom application is a distributed application that runs partly on
the server, partly on a browser. The program is written entirely in
OCaml, with a syntax extension to distinguish between server and
client code.  During the compilation process, the program is decoupled
into server and client parts. The server part is compiled as is
standard for OCaml code, while the client part is compiled to
Javascript to be run in the browser.
</p><p>For developing an Eliom application, we recommend that you use our
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/manual/ppx-syntax.html">PPX syntax extension</a></span>.
</p><p>An interesting feature of Eliom applications is that the client-side process
does not stop when you click on a link or send a form, and it is possible to
keep the traditional Web interaction (with URLs, bookmarks, back button, etc).
For example, if the page is playing music, the music won't stop when
the user proceeds to other pages on the Web site.
</p><p>Client-side parts are using <span><a class="ocsforge_doclink_lwt" href="/lwt/3.1.0/manual/manual.html">Lwt</a></span>, enabling
concurrency in the browser very easily.
</p><p>As both parts are implemented in OCaml, it is very easy to use client-side
OCaml data on server side, and vice-versa. Eliom handles the communication
between client and server automatically in both directions. For example,
it is possible to use a server-side variable in the client program.
</p><p>Eliom also implements an &quot;HTTP-push&quot; mechanism, allowing the server
to send messages to a client.
</p><p>Client-side parts of the program can use most Eliom features, just as
usual, for example to create HTML, links, and forms from services.
</p><p>On the server, it is possible to save data (some state) for each
client process (that is, one tab in a browser), simply by using Eliom
references with scope <span class="teletype">`Client_process</span>.  You can register
services for one client process, or even set cookies for one tab.
</p><h3> How it works</h3><p>The code of an Eliom application is written in OCaml, with <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/manual/clientserver-language.html">a syntax extension</a></span> to distinguish
between server and client code. The files using this syntax
usually have the extension <span class="teletype">.eliom</span>. As the compling process is quite
complex, we provide commands called <span class="teletype">eliomc</span>, <span class="teletype">eliomopt</span> and <span class="teletype">js_of_eliom</span> that
do everything for you: separating client and server parts, calling
<span class="teletype">ocamlc</span>, <span class="teletype">ocamlopt</span>, <span class="teletype">js_of_ocaml</span>, etc.
</p><p>Services belonging to the application are registered using the module
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_registration.App.html">Eliom_registration.​App</a></span>. More precisely,
this is a functor that needs to be applied for each application you create.
These services just return HTML pages as usual (using
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_content.Html.html">Eliom_content.​Html</a></span>)
The client-side program (compiled in JavaScript) is added automatically by Eliom,
with all its data, and run automatically when the page is loaded.
</p><p>Module <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/Eliom_client.html">Eliom_client</a></span> provides
useful functions for client side programming with Eliom: e.g.
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/Eliom_client.html#VALchange_page">Eliom_client.​change_page</a></span>
permits switching to another page.
</p><p>Module <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_comet.html">Eliom_comet</a></span> allows the
server to send notifications
to the client (even if the client is not explicitely doing a request).
Use module <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/server/Eliom_react.html">Eliom_react</a></span> to make client-server reactive
programming (using the <a href="http://erratique.ch/software/react" class="ocsimore_phrasing_link"> React</a>
external library).
</p><h3> The App functor</h3><p>For each Eliom application, you must create a service registration module
by applying the <span class="teletype">App</span> functor:
</p><p>&lt;&lt;code language=&quot;ocaml&quot;|
module My_app =
  Eliom_registration.App (
    struct
      let application_name = &quot;the name of your application&quot;
      let global_data_path = None
    end)
&gt;&gt;
</p><p>the <span class="teletype">application_name</span> parameter is the name of the JavaScript file
containing the application.
</p><p><span class="teletype">global_data_path</span> specifies the path of an auxilliary service
needed for mobile apps, and you can provide <span class="teletype">None</span> for standard
Web applications.
</p><p>Then you can do for example:
&lt;&lt;code language=&quot;ocaml&quot;|
let my_service =
  My_app.create
    ~path:(Eliom_service.Path [&quot;&quot;])
    ~meth:(Eliom_service.Get Eliom_parameter.unit)
    (fun () () -&gt; Lwt.return (html
                               (head (title (pcdata &quot;Hi!&quot;)) [])
                               (body [p [pcdata &quot;Hey.&quot;]])))
&gt;&gt;
</p><p>Eliom will add automatically the required headers to send the client side
program and all its data.
</p><h2> Application, life and death</h2><p>When an user enters the page of a service registered by an application
module (created with the <span class="teletype">App</span> functor), the application
is started. During the life of the application, a single OCaml program
will run on the browser: Lwt threads will keep running, global
variables will stay available, etc.  until the application is
closed. The application will keep running when the user clicks on
links to pages inside the same application.
</p><p>This application will be closed when:
</p><ul><li> the user closes the browser tab containing the application,
</li><li> the user goes to a page outside of the application,
</li><li> the user changes the current url by another mean than the
application interaction (reload the page with <span class="teletype">F5</span>,
manual typing of URL, ...),
</li><li> the application call the
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/Eliom_client.html#VALexit_to">Eliom_client.​exit_to</a></span> function.
</li></ul><p>It is possible to prevent the application from starting when visiting
an application page by setting the <span class="teletype">do_not_launch</span> to <span class="teletype">true</span>
at the service registration:
&lt;&lt;code language=&quot;ocaml&quot;|
let no_launch_service =
  My_app.register
    ~option:{ Eliom_registration.default_appl_service_options with
              do_not_launch = true }
    ~path:(Eliom_service.Path [&quot;&quot;])
    ~meth:(Eliom_service.Get Eliom_parameter.unit)
    (fun () () -&gt; Lwt.return (html
                               (head (title (pcdata &quot;Hi!&quot;)) [])
                               (body [p [pcdata &quot;Hey.&quot;]])))
&gt;&gt;
That way, you can delay JavaScript loading until it is really needed.
Visiting a service registered with <span class="teletype">do_not_launch=true</span> will not stop
a running application.
</p><p>By default, every link of form towards another service of the same
application is reimplemented by Eliom so that it does not stop the application.
Instead of asking the browser to load a new page, Eliom does an
XML HTTP request (XHR).
You can avoid this and insert regular links or forms by adding the optional
parameter <span class="teletype">~xhr:false</span>.
This will force reloading the application when the link is clicked.
</p><h3> Navigating in and out of the application.</h3><p>Two functions are available client-side for changing the current page
without interaction from the user. The function
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/Eliom_client.html#VALchange_page">Eliom_client.​change_page</a></span> goes to the service
taken as parameter. If the service is in another application or not in
an application, the current application will be stopped.
The function <span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/Eliom_client.html#VALwindow_open">Eliom_client.​window_open</a></span>
opens an
Eliom service in a new browser window (cf. JavaScript's <span class="teletype">window.open</span>).
<span><a class="ocsforge_doclink_eliom" href="/eliom/6.2/api/client/Eliom_client.html#VALexit_to">Eliom_client.​exit_to</a></span>
changes the current page and always leaves the application.
</p><h3> Leaving application and going back</h3><p>Usually, when going to an application page, a new client process is
launched on the server, but there are situations where an old client
process is used instead: Browsers tend to take the result from their
cache when using the back button even if the page was marked (by HTTP
headers) as non-cacheable.
</p></body></html>
